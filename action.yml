name: "Get Project Id"
author: 'Tetsuya Mori'
description: 'Get Project Id of GitHub Projects (Beta)'
inputs:
  github-token:
    default: ''
    required: true
    description: 'Personal Access Token that with `repo`, `org:read` and `org:write` are granted.'
  owner:
    default: ''
    required: true
    description: 'User/Organization name project contains.'
  owner-type:
    default: 'organization'
    required: false
    description: 'Type of owner: User, Organization'
  project-number:
    default: 0
    required: true
    description: 'The number of the target project.'
outputs:
  project-id:
    description: 'Project Id that can be obtained from a given organization and number'
    value: ${{ steps.get-project-id.outputs.result }}
runs:
  using: "composite"
  steps:
    - name: Get Project Id
      uses: actions/github-script@v5
      id: get-project-id
      with:
        result-encoding: string
        github-token: ${{ inputs.github-token }}
        script: |
          const variables = {
              headers: {
                'GraphQL-Features': 'projects_next_graphql'
              }
          };
          const query = `
            query {
              ${{ inputs.owner-type }}(login: "${{ inputs.owner }}") {
                projectNext(number: ${{ inputs.project-number }}) {
                  id
                }
              }
            }
          `;
          var result = await github.graphql(query, variables);
          return result.${{ inputs.owner-type }}.projectNext.id || '';
